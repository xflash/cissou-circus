#{extends 'main.html' /}
#{set title:'Group' /}


*{<div class="jumbotron">}*
*{<div class="container">}*
*{<h1>Group dispatch</h1>}*
*{<p>Here is the result of the dispatch</p>}*
*{</div>}*
*{</div>}*

<style rel="stylesheet">
    tr.labels {
        cursor: pointer;
    }

    tr.actions {
        display: none;
    }

    table.table-sm {
        width: 100%;
    }
</style>

<div class="container">
    <div class="row">
        <div class="col-sm">
            <h3>${proposal.name}</h3>
        </div>
    </div>
    <hr/>
    <div class="row">

    #{list items:proposal.groups, as:'schoolEventGroup'}
        #{set groupCount:activitiesCountMap.get(schoolEventGroup.id)/}
        <div class="col-sm">

            <h3>${schoolEventGroup.name}  <span
                    class="badge badge-pill badge-secondary">${schoolEventGroup.studentCount}</span>
            </h3>
            <table class="table-borderless table-sm ">
                <thead>
                <tr>
                    <th scope="row">Activities</th>
                </tr>
                </thead>
                <tbody>

                    #{list items:schoolEventGroup.activities, as:'schoolEventGroupActivity'}
                    <tr>
                        <th scope="row">${schoolEventGroupActivity.schoolEventActivity.name} <span
                                class="badge badge-primary">${groupCount.get(schoolEventGroupActivity.schoolEventActivity.id)}</span>
                        </th>
                    </tr>
                    <tr>
                        <td>
                            <table class="table-sm ">
                                #{list items:schoolEventGroupActivity.assignments, as:'schoolEventGroupStudentAssignment'}
                                    #{set studentChoice:schoolEventGroupStudentAssignment.studentChoices /}
                                    <tr class="labels" data-id="${studentChoice.student.id}">
                                    *{#{if studentChoice.sibling}<i class="fas fa-child"></i>#{/if}}*
                                        <td colspan="3">${studentChoice.student.name} ${studentChoice.student.firstname}
                                        </td>

                                        <td colspan="2">
                                            <span
                                                    class="badge badge-pill badge-dark text-right">${studentChoice.student.classroom.name}</span>
                                        </td>
                                        <td>
                                            <i class="fas fa-chevron-down"></i>
                                        </td>
                                    </tr>

                                    <tr class="actions" data-id="${studentChoice.student.id}">
                                        <td>
                                            #{if !schoolEventGroup_isFirst}
                                                <a class="btn btn-sm btn-blue-grey"
                                                   href="@{GroupsDispatchs.moveStudentNextGroup(schoolEventGroupStudentAssignment.id, -1)}">&larr;</a>
                                            #{/if}
                                        </td>
                                        <td>
                                            <div class="card" >
                                                <div class="card-body">
                                                    <h5 class="card-title">${studentChoice.choice1.name}</h5>
                                                    <h6 class="card-subtitle mb-2 text-muted">Students: <span
                                                            class="badge badge-primary">${groupCount.get(studentChoice.choice1.id)}</span></h6>
                                                    <p class="card-text">${schoolEventGroupActivity.schoolEventActivity.description}</p>

                                                    <a class="btn btn-sm btn-info ${studentChoice.choice1.id==schoolEventGroupActivity.schoolEventActivity.id?'disabled':''}"
                                                       href="@{GroupsDispatchs.swapStudentActivity(schoolEventGroupStudentAssignment.id, studentChoice.choice1.id)}">Move</a>
                                                </div>
                                            </div>

                                        </td>
                                        <td>
                                            <div class="card" >
                                                <div class="card-body">
                                                    <h5 class="card-title">${studentChoice.choice2.name}</h5>
                                                    <h6 class="card-subtitle mb-2 text-muted">Students: <span
                                                            class="badge badge-primary">${groupCount.get(studentChoice.choice2.id)}</span></h6>
                                                    <p class="card-text">${schoolEventGroupActivity.schoolEventActivity.description}</p>

                                                    <a class="btn btn-sm btn-info ${studentChoice.choice2.id==schoolEventGroupActivity.schoolEventActivity.id?'disabled':''}"
                                                       href="@{GroupsDispatchs.swapStudentActivity(schoolEventGroupStudentAssignment.id, studentChoice.choice2.id)}">Move</a>
                                                </div>
                                            </div>

                                        </td>
                                        <td>
                                            <div class="card" >
                                                <div class="card-body">
                                                    <h5 class="card-title">${studentChoice.choice3.name}</h5>
                                                    <h6 class="card-subtitle mb-2 text-muted">Students: <span
                                                            class="badge badge-primary">${groupCount.get(studentChoice.choice3.id)}</span></h6>
                                                    <p class="card-text">${schoolEventGroupActivity.schoolEventActivity.description}</p>

                                                    <a class="btn btn-sm btn-info ${studentChoice.choice3.id==schoolEventGroupActivity.schoolEventActivity.id?'disabled':''}"
                                                       href="@{GroupsDispatchs.swapStudentActivity(schoolEventGroupStudentAssignment.id, studentChoice.choice3.id)}">Move</a>
                                                </div>
                                            </div>

                                        </td>
                                        <td>
                                            <div class="card" >
                                                <div class="card-body">
                                                    <h5 class="card-title">${studentChoice.choice3.name}</h5>
                                                    <h6 class="card-subtitle mb-2 text-muted">Students: <span
                                                            class="badge badge-primary">${groupCount.get(studentChoice.choice4.id)}</span></h6>
                                                    <p class="card-text">${schoolEventGroupActivity.schoolEventActivity.description}</p>

                                                    <a class="btn btn-sm btn-info ${studentChoice.choice4.id==schoolEventGroupActivity.schoolEventActivity.id?'disabled':''}"
                                                       href="@{GroupsDispatchs.swapStudentActivity(schoolEventGroupStudentAssignment.id, studentChoice.choice4.id)}">Move</a>
                                                </div>
                                            </div>

                                        </td>
                                        <td>
                                            #{if !schoolEventGroup_isLast}
                                                <a class="btn btn-sm btn-blue-grey"
                                                   href="@{GroupsDispatchs.moveStudentNextGroup(schoolEventGroupStudentAssignment.id, 1)}">&rarr;</a>
                                            #{/if}
                                        </td>
                                    </tr>

                                #{/list}

                            </table>
                        </td>
                    </tr>
                    #{/list}
                </tbody>

            </table>

        </div>
    #{/list}
    </div>
</div>


*{#{set 'moreScripts'}}*
*{#{script 'sortable/jquery.sortable.js' /}}*
*{#{/set}}*


<script type="text/javascript">

    $(function () {
        $('tr.labels').click(function (ev) {
            // $(this).removeClass('collapsed');
            var id = $(this).data('id');
            $('tr.actions[data-id!="' + id + '"]').hide();
            $('tr.actions[data-id="' + id + '"]')
                    .toggle();
        })
    })
</script>
